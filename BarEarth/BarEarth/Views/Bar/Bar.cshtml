@model BarEarth.Models.Bar
@{ViewData["Title"] = "Address";}

@section scripts {
    <script type="text/javascript">
        var latitudeBar  = @Model.Latitude;
        var longitudeBar = @Model.Longitude;
    </script>
    <script type="text/javascript" src="~/js/barInfoMap.js"></script>

    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBXqGMybRiPHnWLdwBQ7ubymS7lQg8dIj0&libraries=places&callback=initMap"
            async defer></script>

}
@{

}
<link rel="stylesheet" href="~/css/barViewMap.css" />



@{
    ViewBag.Title = Model.Name;
    var comments = (IEnumerable<BarEarth.Models.Rating>)ViewBag.Comments;
    var ratingSum = ViewBag.RatingSum;
    var ratingCount = ViewBag.RatingCount;
    var str = Model.Type;
    var str2 = Model.OpeningHours;
    var barPhotos = Model.PhotoReference;
    var key = "AIzaSyD4nV1sw-I7t74JHMhwkprurMSzM_WB_V8";

    var types = str.Split(",");
    var openingHours = str2.Split(",");
    var barPhoto = barPhotos.Split(",");
    var photoString = "https://maps.googleapis.com/maps/api/place/photo?maxwidth=400&photoreference=" + barPhoto[0] + "&key=" + key;
    var photoString2 = "https://maps.googleapis.com/maps/api/place/photo?maxwidth=400&photoreference=" + barPhoto[1] + "&key=" + key;
    var photoString3 = "https://maps.googleapis.com/maps/api/place/photo?maxwidth=400&photoreference=" + barPhoto[2] + "&key=" + key;
    var photoString4 = "https://maps.googleapis.com/maps/api/place/photo?maxwidth=400&photoreference=" + barPhoto[3] + "&key=" + key;

    var resultTypes = types[0] + ", " + types[1] + ", " + types[2];

    decimal rating = 0;
    if (ratingCount > 0)
    {
        rating = (ratingSum / ratingCount);
    }
    var totalRating = decimal.Parse(rating.ToString());

}


<!--This is the card that houses our bar-->
<div class="card mb-3" style="width: 70rem;  background-color: #fff; margin:auto; margin-top: 10vh;">
    <div class="card-img-top" style="background-image: url(@photoString); height: 250px; background-position: center; background-repeat: no-repeat; background-size: cover; position: relative;">
        <div class="card-img-overlay d-flex flex-row-reverse ">
            <button type="button" class="btn btn-primary bmd-btn-fab" style="margin-top: 200px;">
                <i class="material-icons">directions</i>
            </button>
        </div>
    </div>

    <!--Here is the banner at top is stored-->
    <div class="SecondaryColor">
        <div class="card-header  ">
            <h2 class="card-title">@Model.Name</h2>
            <h6>



                @for (var i = 1; i <= rating; i++)
                {
                    <i class="material-icons">
                        star
                    </i>
                }
                @for (var i = (rating + 1); i <= 5; i++)
                {
                    <i class="material-icons">
                        star_border
                    </i>
                }
                • @comments.Count() Reviews
            </h6>
            <h6 class="card-subtitle">@resultTypes</h6>
        </div>
    </div>
    <div class="card-body">
        
        <div class="row">
            <div class="col-4">
                <p>
                    Lorem ipsum dolor sit amet, ei vix putent labores adipiscing. Cu cum partem reprimique. Solum consul delenit ex nam, harum solet an eos, harum assentior adipiscing vis ne. Cu eirmod repudiandae his, ad nec eripuit nusquam cotidieque, nam ei vide soluta expetendis.
                </p>
                <table class="table">
                    <tbody>
                        <tr id="BarAddress">
                            <th scope="row"><i class="material-icons">place</i></th>
                            <td>@Model.Address</td>
                        </tr>
                        <tr id="BarOpenTimes">
                            <th scope="row"><i class="material-icons">schedule</i></th>
                            <td>
                                <select>
                                    <option value="monday">@openingHours[0]</option>
                                    <option value="tuesday">@openingHours[1]</option>
                                    <option value="wednesday">@openingHours[2]</option>
                                    <option value="thursday">@openingHours[3]</option>
                                    <option value="friday">@openingHours[4]</option>
                                    <option value="saturday">@openingHours[5]</option>
                                    <option value="sunday">@openingHours[6]</option>
                                </select>

                            </td>
                        </tr>
                        <tr id="BarWebsite">
                            <th scope="row"><i class="material-icons">public</i></th>
                            <td>@Model.Website</td>
                        </tr>
                        <tr id="BarPhone">
                            <th scope="row"><i class="material-icons">local_phone</i></th>
                            <td>@Model.PhoneNumber</td>
                        </tr>
                    </tbody>
                </table>
            </div>
            <div class="col-8">
                <div id="barViewMap"></div>
                <input id="pac-input" class="controls" type="text" placeholder="Search Box">
            </div>

        </div>

        <hr />

        <div id="BarImages" class="carousel slide" data-ride="carousel">
            <div class="carousel-inner">
                <div class="carousel-item active">
                    <img class="d-block w-100" src=@photoString2 alt="First slide">
                </div>
                <div class="carousel-item">
                    <img class="d-block w-100" src=@photoString3 alt="Second slide">
                </div>
                <div class="carousel-item">
                    <img class="d-block w-100" src=@photoString4 alt="Third slide">
                </div>
            </div>
            <a class="carousel-control-prev" href="#BarImages" role="button" data-slide="prev">
                <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                <span class="sr-only">Previous</span>
            </a>
            <a class="carousel-control-next" href="#BarImages" role="button" data-slide="next">
                <span class="carousel-control-next-icon" aria-hidden="true"></span>
                <span class="sr-only">Next</span>
            </a>
        </div>

        <hr />

        <!--Comment section-->
        <h4 class="card-header">Comments</h4>
        <!--Here does the users comment and score sit-->

        @Html.Partial("_CommentBox")

        <form>
            <label class="radio-inline">
                <input type="radio" name="inlineRadioOptions" id="inlineRadio1" value="option1"> Datum(Nyast-Äldst)
            </label>
            <label class="radio-inline">
                <input type="radio" name="inlineRadioOptions" id="inlineRadio2" value="option2"> Datum(Äldst-Nyast)
            </label>
            <label class="radio-inline">
                <input type="radio" name="inlineRadioOptions" id="inlineRadio3" value="option3"> Betyg(Bäst-Lägst)
            </label>
            <label class="radio-inline">
                <input type="radio" name="inlineRadioOptions" id="inlineRadio1" value="option1"> Betyg(Lägst-Bäst)
            </label>
        </form>

        <!--Here's the last 3 comments-->
        @{
            var lastThreeComments = comments.TakeLast(3).Reverse();
        }


        <div class="card-deck">
            @foreach (var c in lastThreeComments)
            {
                <div class="card w-50">
                    <div class="card-body">
                        <h5 class="card-title">@c.UserName</h5>
                        <h6 class="card-subtitle mb-2 text-muted">
                            @for (var i = 1; i <= c.Rate; i++)
                            {
                                <i class="material-icons">star</i>
                            }
                            @for (var i = (c.Rate + 1); i <= 5; i++)
                            {
                                <i class="material-icons">star_border</i>
                            }
                        </h6>
                        <p class="card-text">@c.Review</p>
                        <div class="card-footer">
                            <p class="card-text"><small class="text-muted">@c.DateTime</small></p>
                        </div>
                    </div>
                </div>
            }
        </div>

        <!--Here's the rest with a dropdown function-->

        @{
            var amountOfComments = comments.Count();
            var restOfComments = comments.Take(amountOfComments - 3).Reverse();
        }

        <div id="collapseComments" class="collapse " aria-labelledby="headingOne" data-parent="#accordion" style="margin-top:10px;">
            <div class="card-columns">
                @foreach (var c in restOfComments)
                {
                    <div class="card">
                        <div class="card-body">
                            <h5 class="card-title">@c.UserName</h5>
                            <h6 class="card-subtitle mb-2 text-muted">
                                @for (var i = 1; i <= c.Rate; i++)
                                {
                                    <i class="material-icons">star</i>
                                }
                                @for (var i = (c.Rate + 1); i <= 5; i++)
                                {
                                    <i class="material-icons">star_border</i>
                                }
                            </h6>
                            <p class="card-text">@c.Review</p>
                            <div class="card-footer">
                                <p class="card-text"><small class="text-muted">@c.DateTime</small></p>
                            </div>
                        </div>
                    </div>
                }
            </div>

        </div>

        <div class="card-header nav justify-content-center" id="CommentSection">

                <button class="btn btn-link nav-item" data-toggle="collapse" data-target="#collapseComments" aria-expanded="true" aria-controls="collapseComments">
                    <i class="material-icons">keyboard_arrow_down</i>
                </button>
                
            
        </div>


        <div class="card-text">

        </div>

    </div>
    <div class="card-footer">Importat stuff</div>
</div>



<script>
        function SCRate() {
            for (var i = 1; i <= @totalRating; i++) {
                $("#sRate" + i).attr('class', 'starGlowN');


            }
        }
        $(function(){
            SCRate();
        });
</script>
